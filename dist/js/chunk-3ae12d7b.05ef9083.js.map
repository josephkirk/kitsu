{"version":3,"sources":["webpack:///./src/components/pages/ProductionSchedule.vue?14af","webpack:///src/components/pages/ProductionSchedule.vue","webpack:///./src/components/pages/ProductionSchedule.vue?4158","webpack:///./src/components/pages/ProductionSchedule.vue","webpack:///./src/components/pages/ProductionSchedule.vue?ef0d"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","$t","attrs","locale","days","model","value","callback","$$v","selectedStartDate","expression","selectedEndDate","directives","name","rawName","isCurrentUserAdmin","overallManDays","zoomOptions","zoomLevel","startDate","endDate","scheduleItems","loading","schedule","errors","on","scheduleItemChanged","estimationChanged","changeZoom","expandTaskTypeElement","currentTask","_e","staticRenderFns","components","ComboboxNumber","Datepicker","Schedule","TaskInfo","TextField","data","mounted","reset","computed","user","methods","loadData","loadScheduleItems","currentProduction","event","wheelDelta","start_date","end_date","man_days","toDate","convertScheduleItems","map","item","clone","add","expanded","editable","children","parentElement","taskTypeElement","scheduleItem","route","production","taskType","taskTypeMap","task_type_id","for_shots","action","isTVShow","parameters","saveScheduleItem","getMinDate","getMaxDate","isAfter","minDate","isBefore","maxDate","forEach","socket","watch","editProduction","format","metaInfo","title","component"],"mappings":"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","file":"js/chunk-3ae12d7b.05ef9083.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"columns fixed-page\"},[_c('div',{staticClass:\"column main-column\"},[_c('div',{staticClass:\"flexrow project-dates\"},[_c('div',{staticClass:\"flexrow-item\"},[_c('label',{staticClass:\"label\"},[_vm._v(\" \"+_vm._s(_vm.$t('main.start_date'))+\" \")]),_c('datepicker',{attrs:{\"wrapper-class\":\"datepicker\",\"input-class\":\"date-input input\",\"language\":_vm.locale,\"disabled-dates\":{ days: [6, 0] },\"monday-first\":true,\"format\":\"yyyy-MM-dd\"},model:{value:(_vm.selectedStartDate),callback:function ($$v) {_vm.selectedStartDate=$$v},expression:\"selectedStartDate\"}})],1),_c('div',{staticClass:\"flexrow-item field\"},[_c('label',{staticClass:\"label\"},[_vm._v(\" \"+_vm._s(_vm.$t('main.end_date'))+\" \")]),_c('datepicker',{attrs:{\"wrapper-class\":\"datepicker\",\"input-class\":\"date-input input\",\"language\":_vm.locale,\"disabled-dates\":{ days: [6, 0] },\"monday-first\":true,\"format\":\"yyyy-MM-dd\"},model:{value:(_vm.selectedEndDate),callback:function ($$v) {_vm.selectedEndDate=$$v},expression:\"selectedEndDate\"}})],1),_c('text-field',{directives:[{name:\"focus\",rawName:\"v-focus\"}],staticClass:\"flexrow-item overall-man-days\",attrs:{\"type\":\"number\",\"label\":_vm.$t('schedule.overall_man_days'),\"disabled\":!_vm.isCurrentUserAdmin},model:{value:(_vm.overallManDays),callback:function ($$v) {_vm.overallManDays=$$v},expression:\"overallManDays\"}}),_c('combobox-number',{staticClass:\"flexrow-item zoom-level\",attrs:{\"label\":_vm.$t('schedule.zoom_level'),\"options\":_vm.zoomOptions},model:{value:(_vm.zoomLevel),callback:function ($$v) {_vm.zoomLevel=$$v},expression:\"zoomLevel\"}})],1),_c('schedule',{attrs:{\"start-date\":_vm.startDate,\"end-date\":_vm.endDate,\"hierarchy\":_vm.scheduleItems,\"zoom-level\":_vm.zoomLevel,\"is-loading\":_vm.loading.schedule,\"is-error\":_vm.errors.schedule},on:{\"item-changed\":_vm.scheduleItemChanged,\"estimation-changed\":_vm.estimationChanged,\"change-zoom\":_vm.changeZoom,\"root-element-expanded\":_vm.expandTaskTypeElement}})],1),(_vm.currentTask)?_c('div',{staticClass:\"column side-column is-hidden-mobile hide-small-screen\"},[_c('task-info',{attrs:{\"task\":_vm.currentTask,\"is-loading\":false}})],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n<div\r\n  class=\"columns fixed-page\"\r\n>\r\n  <div\r\n    class=\"column main-column\"\r\n  >\r\n    <div class=\"flexrow project-dates\">\r\n      <div class=\"flexrow-item\">\r\n        <label class=\"label\">\r\n          {{ $t('main.start_date') }}\r\n        </label>\r\n        <datepicker\r\n          wrapper-class=\"datepicker\"\r\n          input-class=\"date-input input\"\r\n          :language=\"locale\"\r\n          :disabled-dates=\"{ days: [6, 0] }\"\r\n          :monday-first=\"true\"\r\n          format=\"yyyy-MM-dd\"\r\n          v-model=\"selectedStartDate\"\r\n        />\r\n      </div>\r\n      <div class=\"flexrow-item field\">\r\n        <label class=\"label\">\r\n          {{ $t('main.end_date') }}\r\n        </label>\r\n        <datepicker\r\n          wrapper-class=\"datepicker\"\r\n          input-class=\"date-input input\"\r\n          :language=\"locale\"\r\n          :disabled-dates=\"{ days: [6, 0] }\"\r\n          :monday-first=\"true\"\r\n          format=\"yyyy-MM-dd\"\r\n          v-model=\"selectedEndDate\"\r\n        />\r\n      </div>\r\n      <text-field\r\n        class=\"flexrow-item overall-man-days\"\r\n        type=\"number\"\r\n        v-model=\"overallManDays\"\r\n        :label=\"$t('schedule.overall_man_days')\"\r\n        :disabled=\"!isCurrentUserAdmin\"\r\n        v-focus\r\n      />\r\n      <combobox-number\r\n        class=\"flexrow-item zoom-level\"\r\n        :label=\"$t('schedule.zoom_level')\"\r\n        :options=\"zoomOptions\"\r\n        v-model=\"zoomLevel\"\r\n      />\r\n    </div>\r\n\r\n    <schedule\r\n      :start-date=\"startDate\"\r\n      :end-date=\"endDate\"\r\n      :hierarchy=\"scheduleItems\"\r\n      :zoom-level=\"zoomLevel\"\r\n      :is-loading=\"loading.schedule\"\r\n      :is-error=\"errors.schedule\"\r\n      @item-changed=\"scheduleItemChanged\"\r\n      @estimation-changed=\"estimationChanged\"\r\n      @change-zoom=\"changeZoom\"\r\n      @root-element-expanded=\"expandTaskTypeElement\"\r\n    />\r\n  </div>\r\n\r\n  <div\r\n    class=\"column side-column is-hidden-mobile hide-small-screen\"\r\n    v-if=\"currentTask\"\r\n  >\r\n    <task-info\r\n      :task=\"currentTask\"\r\n      :is-loading=\"false\"\r\n    />\r\n  </div>\r\n</div>\r\n\r\n</template>\r\n\r\n<script>\r\n/*\r\n * Page to manage the schedule of the big steps of the production. It allows\r\n * to set milestones too.\r\n */\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport moment from 'moment-timezone'\r\nimport { en, fr } from 'vuejs-datepicker/dist/locale'\r\nimport Datepicker from 'vuejs-datepicker'\r\n\r\nimport { sortScheduleItems } from '../../lib/sorting'\r\nimport { getTaskTypeSchedulePath } from '../../lib/path'\r\nimport { daysToMinutes, parseDate } from '../../lib/time'\r\n\r\nimport ComboboxNumber from '../widgets/ComboboxNumber'\r\nimport TaskInfo from '../sides/TaskInfo'\r\nimport TextField from '../widgets/TextField'\r\nimport Schedule from './schedule/Schedule'\r\n\r\nexport default {\r\n  name: 'production-schedule',\r\n  components: {\r\n    ComboboxNumber,\r\n    Datepicker,\r\n    Schedule,\r\n    TaskInfo,\r\n    TextField\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      currentTask: null,\r\n      overallManDays: 0,\r\n      endDate: moment().add(6, 'months').endOf('day'),\r\n      scheduleItems: [],\r\n      startDate: moment().startOf('day'),\r\n      selectedStartDate: null,\r\n      selectedEndDate: null,\r\n      zoomLevel: 2,\r\n      zoomOptions: [\r\n        { label: '1', value: 1 },\r\n        { label: '2', value: 2 },\r\n        { label: '3', value: 3 }\r\n      ],\r\n      loading: {\r\n        schedule: false\r\n      },\r\n      errors: {\r\n        schedule: false\r\n      }\r\n    }\r\n  },\r\n\r\n  mounted () {\r\n    this.reset()\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\r\n      'assetTypeMap',\r\n      'currentEpisode',\r\n      'currentProduction',\r\n      'isCurrentUserAdmin',\r\n      'isCurrentUserManager',\r\n      'isTVShow',\r\n      'organisation',\r\n      'taskTypeMap',\r\n      'timezone',\r\n      'user'\r\n    ]),\r\n\r\n    locale () {\r\n      if (this.user.locale === 'fr_FR') {\r\n        return fr\r\n      } else {\r\n        return en\r\n      }\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      'editProduction',\r\n      'loadAssetTypeScheduleItems',\r\n      'loadEpisodeScheduleItems',\r\n      'loadMilestones',\r\n      'loadScheduleItems',\r\n      'loadSequenceScheduleItems',\r\n      'saveScheduleItem'\r\n    ]),\r\n\r\n    loadData () {\r\n      this.loading.schedule = true\r\n      this.loadScheduleItems(this.currentProduction)\r\n        .then((scheduleItems) => {\r\n          scheduleItems = scheduleItems.map((item) => {\r\n            const taskType = this.taskTypeMap[item.task_type_id]\r\n            let startDate, endDate\r\n            if (item.start_date) {\r\n              startDate = parseDate(item.start_date)\r\n            } else {\r\n              startDate = moment()\r\n            }\r\n            if (item.end_date) {\r\n              endDate = parseDate(item.end_date)\r\n            } else {\r\n              endDate = startDate.clone().add(1, 'days')\r\n            }\r\n\r\n            return {\r\n              ...item,\r\n              color: taskType.color,\r\n              for_shots: taskType.for_shots,\r\n              name: taskType.name,\r\n              priority: taskType.priority,\r\n              startDate: startDate,\r\n              endDate: endDate,\r\n              editable: this.isCurrentUserManager,\r\n              expanded: false,\r\n              loading: false,\r\n              route: getTaskTypeSchedulePath(\r\n                taskType.id,\r\n                this.currentProduction.id,\r\n                this.currentEpisode ? this.currentEpisode.id : null,\r\n                taskType.for_shots ? 'shots' : 'assets'\r\n              ),\r\n              children: []\r\n            }\r\n          })\r\n          this.scheduleItems =\r\n            sortScheduleItems(scheduleItems, this.taskTypeMap)\r\n          this.loading.schedule = false\r\n        })\r\n        .then(this.loadMilestones)\r\n        .catch((err) => {\r\n          console.error(err)\r\n          this.loading.schedule = false\r\n        })\r\n    },\r\n\r\n    changeZoom (event) {\r\n      if (event.wheelDelta < 0 && this.zoomLevel > 1) this.zoomLevel--\r\n      if (event.wheelDelta > 0 && this.zoomLevel < 3) this.zoomLevel++\r\n    },\r\n\r\n    reset () {\r\n      if (this.currentProduction.start_date) {\r\n        this.startDate =\r\n          parseDate(this.currentProduction.start_date)\r\n      }\r\n      if (this.currentProduction.end_date) {\r\n        this.endDate = parseDate(this.currentProduction.end_date)\r\n      }\r\n      this.overallManDays = this.currentProduction.man_days\r\n      this.selectedStartDate = this.startDate.toDate()\r\n      this.selectedEndDate = this.endDate.toDate()\r\n      this.loadData()\r\n    },\r\n\r\n    convertScheduleItems (taskTypeElement, scheduleItems) {\r\n      return scheduleItems.map((item) => {\r\n        let startDate, endDate\r\n        if (item.start_date) {\r\n          startDate = parseDate(item.start_date)\r\n        } else {\r\n          startDate = moment()\r\n        }\r\n        if (item.end_date) {\r\n          endDate = parseDate(item.end_date)\r\n        } else {\r\n          endDate = startDate.clone().add(1, 'days')\r\n        }\r\n        const scheduleItem = {\r\n          ...item,\r\n          startDate: startDate,\r\n          endDate: endDate,\r\n          expanded: false,\r\n          loading: false,\r\n          editable: this.isCurrentUserManager,\r\n          children: [],\r\n          parentElement: taskTypeElement\r\n        }\r\n        if (this.isTVShow) {\r\n          scheduleItem.route = getTaskTypeSchedulePath(\r\n            item.task_type_id,\r\n            this.currentProduction.id,\r\n            item.object_id,\r\n            taskTypeElement.for_shots ? 'shots' : 'assets'\r\n          )\r\n        }\r\n        return scheduleItem\r\n      })\r\n    },\r\n\r\n    expandTaskTypeElement (taskTypeElement) {\r\n      const parameters = {\r\n        production: this.currentProduction,\r\n        taskType: this.taskTypeMap[taskTypeElement.task_type_id]\r\n      }\r\n\r\n      taskTypeElement.expanded = !taskTypeElement.expanded\r\n      if (taskTypeElement.expanded) {\r\n        taskTypeElement.loading = true\r\n        let action = 'loadAssetTypeScheduleItems'\r\n        if (taskTypeElement.for_shots) {\r\n          if (this.isTVShow) action = 'loadEpisodeScheduleItems'\r\n          else action = 'loadSequenceScheduleItems'\r\n        }\r\n\r\n        this[action](parameters)\r\n          .then((scheduleItems) => {\r\n            taskTypeElement.loading = false\r\n            taskTypeElement.children = this.convertScheduleItems(\r\n              taskTypeElement,\r\n              scheduleItems\r\n            )\r\n          })\r\n          .catch((err) => {\r\n            console.error(err)\r\n            taskTypeElement.loading = false\r\n            taskTypeElement.children = []\r\n          })\r\n      }\r\n    },\r\n\r\n    estimationChanged ({ item, days }) {\r\n      item.man_days = daysToMinutes(this.organisation, days)\r\n      this.saveScheduleItem(item)\r\n    },\r\n\r\n    scheduleItemChanged (item) {\r\n      if (item.startDate && item.endDate && item.parentElement) {\r\n        item.parentElement.startDate = this.getMinDate(item.parentElement)\r\n        item.parentElement.endDate = this.getMaxDate(item.parentElement)\r\n        this.saveScheduleItem(item.parentElement)\r\n      } else if (!item.parentElement) {\r\n        const minDate = this.getMinDate(item)\r\n        const maxDate = this.getMaxDate(item)\r\n        if (item.startDate.isAfter(minDate)) item.startDate = minDate\r\n        if (item.endDate.isBefore(maxDate)) {\r\n          item.endDate = maxDate.add(-1, 'days')\r\n        }\r\n      }\r\n      this.saveScheduleItem(item)\r\n    },\r\n\r\n    getMinDate (parentElement) {\r\n      let minDate = this.endDate.clone()\r\n      parentElement.children.forEach((item) => {\r\n        if (item.startDate && item.startDate.isBefore(minDate)) {\r\n          minDate = item.startDate\r\n        }\r\n      })\r\n      return minDate.clone()\r\n    },\r\n\r\n    getMaxDate (parentElement) {\r\n      let maxDate = this.startDate.clone()\r\n      parentElement.children.forEach((item) => {\r\n        if (item.endDate && item.endDate.isAfter(maxDate)) {\r\n          maxDate = item.endDate\r\n        }\r\n      })\r\n      return maxDate.clone()\r\n    }\r\n  },\r\n\r\n  socket: {\r\n  },\r\n\r\n  watch: {\r\n    selectedStartDate () {\r\n      this.startDate = parseDate(this.selectedStartDate)\r\n      this.editProduction({\r\n        ...this.currentProduction,\r\n        start_date: this.startDate.format('YYYY-MM-DD')\r\n      })\r\n    },\r\n\r\n    selectedEndDate () {\r\n      this.endDate = parseDate(this.selectedEndDate)\r\n      this.editProduction({\r\n        ...this.currentProduction,\r\n        end_date: this.endDate.format('YYYY-MM-DD')\r\n      })\r\n    },\r\n\r\n    overallManDays () {\r\n      if (this.overallManDays !== this.currentProduction.man_days) {\r\n        this.editProduction({\r\n          ...this.currentProduction,\r\n          man_days: this.overallManDays\r\n        })\r\n      }\r\n    },\r\n\r\n    currentProduction () {\r\n      this.reset()\r\n    }\r\n  },\r\n\r\n  metaInfo () {\r\n    if (this.isTVShow) {\r\n      return {\r\n        title: `${this.currentProduction ? this.currentProduction.name : ''}` +\r\n               ` - ${this.currentEpisode ? this.currentEpisode.name : ''}` +\r\n               ` | ${this.$t('schedule.title')} - Kitsu`\r\n      }\r\n    } else {\r\n      return {\r\n        title: `${this.currentProduction.name} ` +\r\n               `| ${this.$t('schedule.title')} - Kitsu`\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.dark {\r\n  .project-dates {\r\n    color: $white-grey;\r\n    border-bottom: 1px solid $grey;\r\n  }\r\n}\r\n\r\n.project-dates {\r\n  border-bottom: 1px solid #EEE;\r\n  padding-bottom: 1em;\r\n\r\n  .field {\r\n    padding-bottom: 0;\r\n    margin-bottom: 0;\r\n  }\r\n\r\n  .overall-man-days {\r\n    width: 120px;\r\n    font-size: 0.9em;\r\n    margin-right: 1em;\r\n  }\r\n}\r\n\r\n.fixed-page {\r\n  padding: 1em;\r\n  padding-top: 90px;\r\n  padding-left: 2em;\r\n}\r\n\r\n.main-column {\r\n  display: flex;\r\n  border: 0;\r\n  overflow: hidden;\r\n  flex-direction: column;\r\n}\r\n\r\n.zoom-level {\r\n  margin-top: -10px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ProductionSchedule.vue?vue&type=template&id=0cbb867e&scoped=true&\"\nimport script from \"./ProductionSchedule.vue?vue&type=script&lang=js&\"\nexport * from \"./ProductionSchedule.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ProductionSchedule.vue?vue&type=style&index=0&id=0cbb867e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0cbb867e\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=style&index=0&id=0cbb867e&lang=scss&scoped=true&\""],"sourceRoot":""}