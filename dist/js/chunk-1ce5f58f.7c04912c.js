(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ce5f58f"],{"2dc7":function(t,e,a){},"3d8f":function(t,e,a){},6508:function(t,e,a){"use strict";a("9865")},"687f":function(t,e,a){},6982:function(t,e,a){"use strict";a("2dc7")},9865:function(t,e,a){},"9dcd":function(t,e,a){"use strict";a("3d8f")},a9a2:function(t,e,a){"use strict";a("687f")},cd92:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"flexrow filters"},[a("div",{staticClass:"flexrow-item"},[a("combobox-task-type",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.type_label"),"task-type-list":t.shotTaskTypes},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}})],1),a("div",{staticClass:"flexrow-item"},[a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.detail_label"),options:t.detailLevelOptions},model:{value:t.detailLevelString,callback:function(e){t.detailLevelString=e},expression:"detailLevelString"}})],1),"day"===t.detailLevelString?a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.month_label"),options:t.monthOptions},model:{value:t.monthString,callback:function(e){t.monthString=e},expression:"monthString"}}):t._e(),a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.year_label"),options:t.yearOptions},model:{value:t.yearString,callback:function(e){t.yearString=e},expression:"yearString"}}),a("div",{staticClass:"flexrow-item"},[a("combobox",{staticClass:"flexrow-item",attrs:{label:t.$t("quota.count_label"),options:t.countModeOptions},model:{value:t.countMode,callback:function(e){t.countMode=e},expression:"countMode"}})],1)],1),a("quota",{attrs:{taskTypeId:t.taskTypeId,detailLevel:t.detailLevelString,year:t.currentYear,month:t.currentMonth,week:t.currentWeek,day:t.currentDay,currentPerson:t.currentPerson,countMode:t.currentMode}})],1),t.showInfo?a("div",{staticClass:"column side-column"},[a("people-quota-info",{attrs:{person:t.currentPerson,year:t.currentYear,month:t.currentMonth,week:t.currentWeek,day:t.currentDay,"is-loading":!1,"is-loading-error":!1,shots:t.personShots,"count-mode":t.countMode},on:{close:t.hideSideInfo}})],1):t._e()])},n=[],s=(a("c975"),a("d81d"),a("a9e3"),a("5530")),r=a("7f45"),i=a.n(r),u=a("2f62"),c=a("3657"),d=a("9d8b"),l=a("992f"),h=a("e4fd"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"data-list"},[a("div",{ref:"body",staticClass:"datatable-wrapper"},[a("table",{staticClass:"datatable"},[a("thead",{staticClass:"datatable-head"},[a("tr",[a("th",{ref:"rowHeaderName",staticClass:"name datatable-row-header",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("quota.name"))+" ")]),a("th",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX},attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("quota.average"))+" ")]),t._l(t.monthRange,(function(e){return"month"===t.detailLevel?a("th",{key:"month-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(t.monthToString(e))+" ")]):t._e()})),t._l(t.weekRange,(function(e){return"week"===t.detailLevel?a("th",{key:"week-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()})),t._l(t.dayRange,(function(e){return"day"===t.detailLevel?a("th",{key:"day-"+e,attrs:{scope:"col"}},[t._v(" "+t._s(e)+" ")]):t._e()}))],2)]),this.quotaLength>0&&!t.isLoading?a("tbody",{staticClass:"datatable-body"},t._l(t.personIds,(function(e){return a("tr",{key:"name-"+e,staticClass:"datatable-row"},[a("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[a("div",{staticClass:"flexrow"},[a("people-avatar",{attrs:{size:30,person:t.personMap[e]}}),t._v(" "+t._s(t.personMap[e].full_name)+" ")],1)]),"month"===t.detailLevel?a("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year}))+" ")]):t._e(),"week"===t.detailLevel?a("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year}))+" ")]):t._e(),"day"===t.detailLevel?a("td",{staticClass:"average datatable-row-header",style:{left:t.averageColumnX}},[t._v(" "+t._s(t.getQuotaAverage(e,{year:t.year,month:t.month}))+" ")]):t._e(),t._l(t.monthRange,(function(o){return"month"===t.detailLevel?a("td",{key:"month-"+o,class:{selected:t.isMonthSelected(e,t.year,o)}},[t.getQuota(e,{year:t.year,month:o})?a("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-month-person",params:{person_id:e,year:t.year,month:o}})}},[t._v(" "+t._s(t.getQuota(e,{year:t.year,month:o}))+" ")]):a("span",[t._v("-")])],1):t._e()})),t._l(t.weekRange,(function(o){return"week"===t.detailLevel?a("td",{key:"week-"+o,class:{selected:t.isWeekSelected(e,t.year,o)}},[t.getQuota(e,{year:t.year,week:o})?a("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-week-person",params:{person_id:e,year:t.year,week:o}})}},[t._v(" "+t._s(t.getQuota(e,{year:t.year,week:o}))+" ")]):a("span",[t._v(" - ")])],1):t._e()})),t._l(t.dayRange,(function(o){return"day"===t.detailLevel?a("td",{key:"day-"+o,class:{weekend:t.isWeekend(t.year,t.month,o),selected:t.isDaySelected(e,t.year,t.month,o)}},[t.getQuota(e,{year:t.year,month:t.month,day:o})?a("router-link",{staticClass:"quota-button",attrs:{to:t.episodifyRoute({name:"quota-day-person",params:{person_id:e,year:t.year,month:t.month,day:o}})}},[t._v(" "+t._s(t.getQuota(e,{year:t.year,month:t.month,day:o}))+" ")]):a("span",[t._v(" - ")])],1):t._e()}))],2)})),0):t._e()])]),0!==this.quotaLength||t.isLoading?t._e():a("div",{staticClass:"has-text-centered empty-quota"},[a("p",{staticClass:"info"},[t._v(t._s(t.$t("quota.no_quota")))])]),a("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}})],1)},y=[],m=(a("99af"),a("caad"),a("b680"),a("b64b"),a("d3b7"),a("25f0"),a("4d90"),a("eb8c")),f=a("e60b"),v={name:"quota",components:{PeopleAvatar:m["a"],TableInfo:f["a"]},props:{taskTypeId:{type:String,required:!0},detailLevel:{type:String,default:"day",required:!0},countMode:{type:String,default:"frames",required:!0},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0}},data:function(){return{currentMonth:i()().month()+1,currentYear:i()().year(),currentWeek:i()().week(),detailsTitle:"",detailsMap:{},isPanelShown:!1,isLoading:!0,isError:!1,quotaMap:{},quotaLength:0,selected:void 0,averageColumnX:"12rem"}},mounted:function(){var t=this;Object.keys(this.shotMap).length<2?setTimeout((function(){t.loadShots((function(e){setTimeout((function(){t.isLoading=!1}),200),e||t.loadData()}))}),100):(this.isShotsLoading||(this.isLoading=!1),this.loadData())},computed:Object(s["a"])(Object(s["a"])({},Object(u["c"])(["currentEpisode","isShotsLoading","shotMap","personMap"])),{},{monthRange:function(){return Object(c["l"])(this.year,this.currentYear,this.currentMonth)},dayRange:function(){return Object(c["h"])(this.year,this.month,this.currentYear,this.currentMonth)},weekRange:function(){return Object(c["n"])(this.year,this.currentYear,this.currentWeek)},personIds:function(){var t=this,e=Object.keys(this.quotaMap);return e.sort((function(e,a){var o=t.personMap[e].full_name,n=t.personMap[a].full_name;return o.localeCompare(n)}))}}),methods:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["loadShots","computeQuota","getPeriodDetails"])),{},{episodifyRoute:function(t){return this.currentEpisode&&Object(d["a"])(t,this.currentEpisode.id),t},isWeekend:function(t,e,a){var o=i()("".concat(t,"-").concat(e,"-").concat(a),"YYYY-MM-DD");return a<10&&(o=i()("".concat(t,"-").concat(e,"-0").concat(a),"YYYY-MM-DD")),[0,6].includes(o.day())},loadData:function(){var t=this;this.taskTypeId&&this.computeQuota({taskTypeId:this.taskTypeId,detailLevel:this.detailLevel,countMode:this.countMode}).then((function(e){t.quotaMap=e,t.isLoading=!1,t.quotaLength=Object.keys(t.quotaMap).length,t.calcAverageColumnX()}))},loadDetails:function(t,e){var a=this;this.loadShots((function(o){a.isLoading=!0,o?console.error(o):a.taskTypeId&&a.getPeriodDetails({taskTypeId:a.taskTypeId,detailLevel:a.detailLevel,personId:t,dateString:e}).then((function(t){a.detailsMap=t,a.isLoading=!1}))}))},monthToString:c["p"],dateDigit:function(t){return t.toString().padStart(2,"0")},getQuota:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.day){var a="".concat(e.year,"-").concat(this.dateDigit(e.month),"-").concat(this.dateDigit(e.day));return this.quotaMap[t][a]}if(e.week){var o="".concat(e.year,"-").concat(e.week);return this.quotaMap[t][o]}var n="".concat(e.year,"-").concat(this.dateDigit(e.month));return this.quotaMap[t][n]},getQuotaAverage:function(t){var e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.month){var o=a.year+"-"+this.dateDigit(a.month);e=this.quotaMap[t].average[o]}else if(a.week){var n="".concat(a.year,"-").concat(a.week);e=this.quotaMap[t].average[n]}else this.quotaMap[t].average&&(e=this.quotaMap[t].average[a.year]);return e?e.toFixed(2):"-"},isDaySelected:function(t,e,a,o){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.month===a&&this.$route.params.day===o},isWeekSelected:function(t,e,a){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.week===a},isMonthSelected:function(t,e,a){return this.$route.params.person_id&&this.$route.params.person_id===t&&this.$route.params.year===e&&this.$route.params.month===a},calcAverageColumnX:function(){this.quotaLength>0&&(this.averageColumnX="".concat(this.$refs.rowHeaderName.offsetWidth,"px"))}}),watch:{taskTypeId:function(){this.taskTypeId&&this.loadData()},detailLevel:function(){this.loadData()},countMode:function(){this.loadData()},shotMap:function(){this.loadData()},$route:function(){var t=this,e=document.getElementsByClassName("selected");0===e.length&&setTimeout((function(){t.$refs.body.scrollLeft+=380}),100)}}},g=v,b=(a("6982"),a("2877")),k=Object(b["a"])(g,p,y,!1,null,"11fcb350",null),_=k.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"people-timesheet-info"},[a("div",{staticClass:"close"},[a("router-link",{staticClass:"close-button",attrs:{to:t.closeRoute}},[a("x-icon")],1)],1),a("div",{staticClass:"flexrow"},[a("people-avatar",{staticClass:"flexrow-item",attrs:{person:t.person,"no-cache":!0}}),a("page-title",{staticClass:"flexrow-item",attrs:{text:t.person.full_name}})],1),t.isMonthInfo?a("div",{staticClass:"info-date"},[t._v(" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t.isWeekInfo?a("div",{staticClass:"info-date"},[t._v(" week "+t._s(t.week)+", "+t._s(t.startDay)+" - "+t._s(t.endDay)+" "+t._s(t.weekMonth)+" "+t._s(t.year)+" ")]):t.isDayInfo?a("div",{staticClass:"info-date"},[t._v(" "+t._s(t.day)+" "+t._s(t.monthString)+" "+t._s(t.year)+" ")]):t._e(),a("quota-shot-list",{staticClass:"time-spent-list",attrs:{"count-mode":t.countMode,shots:t.shots,"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)},w=[],S=(a("b0c0"),a("0a35")),L=a("8d07"),q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"data-list"},[t.isLoading?t._e():a("table",{staticClass:"details table"},[a("thead",[a("tr",[a("th",[t._v(t._s(t.$t("quota.details_name")))]),a("th",[t._v(" "+t._s("seconds"===this.countMode?t.$t("quota.details_seconds"):t.$t("quota.details_frames"))+" ")])])]),a("tbody",t._l(t.shots,(function(e){return a("tr",{key:"shot-quota-"+e.id},[a("td",[t._v(t._s(e.full_name))]),a("td",[t._v(t._s(t.getQuota(e)))])])})),0)]),a("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isLoadingError}})],1)},C=[],O=a("bcd2"),I={name:"quota-shot-list",components:{TableInfo:f["a"]},data:function(){return{projectNames:{}}},props:{shots:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},countMode:{type:String,default:"frames"}},computed:Object(s["a"])({},Object(u["c"])(["currentProduction","lastProductionScreen","taskTypeMap"])),methods:Object(s["a"])(Object(s["a"])({},Object(u["b"])([])),{},{getQuota:function(t){return"seconds"===this.countMode?Object(O["c"])(t.nb_frames,this.currentProduction,t):t.nb_frames}}),watch:{}},$=I,T=(a("6508"),Object(b["a"])($,q,C,!1,null,"363f2e28",null)),j=T.exports,x={name:"shot-quota-info",components:{XIcon:S["cb"],PageTitle:L["a"],PeopleAvatar:m["a"],QuotaShotList:j},props:{person:{type:Object,default:function(){}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},countMode:{type:String,default:"frames"},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},shots:{type:Array,default:function(){return[]}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["c"])(["currentEpisode","currentProduction"])),{},{startDay:function(){return i()().day("Monday").year(this.year).week(this.week).date()},endDay:function(){return i()().day("Monday").year(this.year).week(this.week).add("days",6).date()},weekMonth:function(){return i()().day("Monday").year(this.year).week(this.week).format("MMM")},monthString:function(){return Object(c["p"])(this.month)},isMonthInfo:function(){return this.$route.path.indexOf("month")>0},isWeekInfo:function(){return this.$route.path.indexOf("week")>0},isDayInfo:function(){return this.$route.path.indexOf("day")>0},closeRoute:function(){if(!this.currentProduction)return{};var t={name:"quota",production_id:this.currentProduction.id};return this.isMonthInfo?t={name:"quota-month",params:{year:this.year}}:this.isWeekInfo?t={name:"quota-week",params:{year:this.year}}:this.isDayInfo&&(t={name:"quota-day",params:{year:this.year,month:this.month}}),this.currentEpisode&&(t.name="episode-".concat(t.name),t.params.episode_id=this.currentEpisode.id),t}}),methods:Object(s["a"])(Object(s["a"])({},Object(u["b"])([])),{},{onCloseClicked:function(){this.$emit("close")}})},D=x,P=(a("a9a2"),Object(b["a"])(D,M,w,!1,null,"5ef21a06",null)),R=P.exports,E={name:"production-quota",components:{Combobox:l["a"],ComboboxTaskType:h["a"],PeopleQuotaInfo:R,Quota:_},data:function(){return{taskTypeId:"",countMode:"frames",countModeOptions:[{label:"Frames",value:"frames"},{label:"Seconds",value:"seconds"}],detailLevelOptions:[{label:"Day",value:"day"},{label:"Week",value:"week"},{label:"Month",value:"month"}],currentYear:i()().year(),currentMonth:i()().month()+1,currentWeek:i()().week(),currentDay:i()().date(),currentPerson:this.getCurrentPerson(),currentMode:"frames",detailLevelString:"day",detailLevel:"day",isLoading:!1,isLoadingError:!1,monthString:"".concat(i()().month()+1),personShots:[],showInfo:!1,yearString:"".concat(i()().year())}},mounted:function(){this.loadRoute()},computed:Object(s["a"])(Object(s["a"])({},Object(u["c"])(["currentEpisode","currentProduction","shotTaskTypes","personMap"])),{},{yearOptions:function(){var t=2018,e=i()().year();return Object(c["s"])(t,e).map((function(t){return{label:t,value:"".concat(t)}}))},monthOptions:function(){var t="".concat(i()().year()),e=1,a=i()().month()+1,o=Object(c["s"])(e,12);return t===this.yearString&&(o=Object(c["s"])(e,a)),o.map((function(t){return{label:Object(c["p"])(t),value:"".concat(t)}}))}}),methods:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["computeQuota","getPersonShots","loadShots"])),{},{getCurrentPerson:function(){var t=this.$route.params.person_id;return t&&this.personMap?this.personMap[t]:{}},loadRoute:function(){var t=this,e=this.$route.params,a=e.month,o=e.year,n=e.week,s=e.day,r=this.$route.query,i=r.countMode,u=r.taskTypeId;if(this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,i&&(this.countMode=i,this.currentMode=this.countMode),u)this.taskTypeId=u;else{var c="quota:".concat(this.currentProduction.id,":task-type-id");this.taskTypeId=localStorage.getItem(c)||this.shotTaskTypes[0].id}a&&(this.currentMonth=Number(a),this.monthString="".concat(a)),o&&(this.currentYear=Number(o),this.yearString="".concat(o)),n&&(this.currentWeek=Number(n),this.weekString="".concat(n)),s&&(this.currentDay=Number(s)),this.$route.path.indexOf("person")>0?this.getPersonShots({personId:this.currentPerson.id,detailLevel:this.detailLevel,taskTypeId:this.taskTypeId,year:o,month:a,week:n,day:s}).then((function(e){t.personShots=e,t.showSideInfo()})):this.hideSideInfo()},showSideInfo:function(){this.showInfo=!0},hideSideInfo:function(){this.showInfo=!1},episodifyRoute:function(t){return this.currentEpisode&&Object(d["a"])(t,this.currentEpisode.id),t}}),watch:{detailLevelString:function(){if(this.detailLevel!==this.detailLevelString){var t={name:"quota-".concat(this.detailLevelString),params:{year:this.currentYear},query:{countMode:this.countMode}};"day"===this.detailLevelString&&(t.params.month=this.currentMonth),this.$router.push(this.episodifyRoute(t))}},yearString:function(){var t=Number(this.yearString),e=i()().month()+1;if(this.currentYear!==t){var a={name:"quota-".concat(this.detailLevelString),params:{year:t},query:{countMode:this.countMode}};"day"===this.detailLevelString&&(a.params.month="".concat(Math.min(Number(this.monthString),e))),this.$router.push(this.episodifyRoute(a))}},monthString:function(){if(this.currentMonth!==Number(this.monthString)){var t={name:"quota-day",params:{year:this.currentYear,month:Number(this.monthString)},query:{countMode:this.countMode}};this.$router.push(this.episodifyRoute(t))}},countMode:function(){this.currentMode!==this.countMode&&(this.$route.query.countMode!==this.countMode&&this.$router.push({query:{countMode:this.countMode}}),this.currentMode=this.countMode)},taskTypeId:function(){var t="quota:".concat(this.currentProduction.id,":task-type-id");localStorage.setItem(t,this.taskTypeId),this.$route.query.taskTypeId!==this.taskTypeId&&this.$router.push({query:{taskTypeId:this.taskTypeId}})},currentProduction:function(){var t=this;this.isLoading=!0,this.loadShots((function(){t.loadRoute(),t.isLoading=!1}))},currentEpisode:function(){var t=this;this.isLoading=!0,this.loadShots((function(){t.loadRoute(),t.isLoading=!1}))},$route:function(){this.loadRoute()}}},N=E,Q=(a("9dcd"),Object(b["a"])(N,o,n,!1,null,"0e720044",null));e["default"]=Q.exports}}]);
//# sourceMappingURL=chunk-1ce5f58f.7c04912c.js.map