{"version":3,"sources":["webpack:///./src/components/pages/Logs.vue?8406","webpack:///./src/components/pages/Logs.vue?af15","webpack:///src/components/pages/Logs.vue","webpack:///./src/components/pages/Logs.vue?dd6f","webpack:///./src/components/pages/Logs.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","$t","from","today","model","value","callback","$$v","currentDate","expression","on","loadDayEvents","_v","_s","events","length","isLoading","_e","_l","event","key","id","$event","selectLine","formatDate","created_at","name","split","formatType","directives","rawName","selectedEvents","personMap","user_id","Object","keys","data","sort","isLink","getLink","staticRenderFns","components","ButtonSimple","DateField","PageTitle","PeopleAvatar","PeopleName","Spinner","Date","mounted","computed","methods","substring","loadEvents","after","before","linkKeys","includes","entityType","watch","metaInfo","title","component"],"mappings":"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","file":"js/chunk-73eac616.742d65b1.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=style&index=0&id=2bab798e&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logs fixed-page\"},[_c('div',[_c('page-title',{staticClass:\"flexrow-item mb1\",attrs:{\"text\":_vm.$t('logs.title')}})],1),_c('div',{staticClass:\"flexrow\"},[_c('date-field',{staticClass:\"flexrow-item\",attrs:{\"disabled-dates\":{from: _vm.today},\"label\":_vm.$t('logs.current_date_label')},model:{value:(_vm.currentDate),callback:function ($$v) {_vm.currentDate=$$v},expression:\"currentDate\"}}),_c('button-simple',{staticClass:\"flexrow-item\",attrs:{\"icon\":\"refresh\"},on:{\"click\":_vm.loadDayEvents}}),_c('span',{staticClass:\"flexrow-item\"},[_vm._v(\" \"+_vm._s(_vm.events.length)+\" \"+_vm._s(_vm.$t('logs.events'))+\" \")])],1),(!_vm.isLoading && _vm.events.length === 0)?_c('div',{staticClass:\"mt2\"},[_vm._v(\" \"+_vm._s(_vm.$t('logs.empty_list'))+\" \")]):_vm._e(),(_vm.isLoading)?_c('div',{staticClass:\"has-text-centered\"},[_c('spinner')],1):_c('div',{staticClass:\"log-list\"},_vm._l((_vm.events),function(event){return _c('div',{key:event.id,staticClass:\"mt05 event-line\",on:{\"click\":function($event){return _vm.selectLine(event)}}},[_c('div',[_c('span',{staticClass:\"date tag mr1\"},[_vm._v(_vm._s(_vm.formatDate(event.created_at))+\" \")]),_c('span',{staticClass:\"type tag\",attrs:{\"title\":event.name.split(':')[1],\"data-status\":_vm.formatType(event)}},[_vm._v(\" \"+_vm._s(_vm.formatType(event))+\" \")]),_c('span',{staticClass:\"name tag mr1\"},[_vm._v(_vm._s(event.name.split(':')[0]))])]),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selectedEvents[event.id]),expression:\"selectedEvents[event.id]\"}]},[_c('li',{staticClass:\"flexrow\"},[_c('span',{staticClass:\"key\"},[_vm._v(\"user\")]),(event.user_id)?_c('people-avatar',{staticClass:\"flexrow-item\",attrs:{\"size\":20,\"person\":_vm.personMap[event.user_id]}}):_vm._e(),(event.user_id)?_c('people-name',{staticClass:\"flexrow-item\",attrs:{\"person\":_vm.personMap[event.user_id]}}):_vm._e()],1),_vm._l((Object.keys(event.data).sort()),function(key){return _c('li',{key:event.id + '-' + key,staticClass:\"variable\"},[_c('span',{staticClass:\"key\"},[_vm._v(_vm._s(key))]),(_vm.isLink(key))?_c('a',{attrs:{\"href\":_vm.getLink(event, key)}},[_vm._v(\" \"+_vm._s(event.data[key])+\" \")]):_c('span',[_vm._v(_vm._s(event.data[key]))])])})],2)])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"logs fixed-page\">\r\n    <div>\r\n      <page-title class=\"flexrow-item mb1\" :text=\"$t('logs.title')\" />\r\n    </div>\r\n\r\n    <div class=\"flexrow\">\r\n      <date-field\r\n        class=\"flexrow-item\"\r\n        :disabled-dates=\"{from: today}\"\r\n        :label=\"$t('logs.current_date_label')\"\r\n        v-model=\"currentDate\"\r\n      />\r\n      <button-simple\r\n        class=\"flexrow-item\"\r\n        icon=\"refresh\"\r\n        @click=\"loadDayEvents\"\r\n      />\r\n      <span class=\"flexrow-item\">\r\n        {{ events.length }} {{ $t('logs.events') }}\r\n      </span>\r\n    </div>\r\n\r\n    <div class=\"mt2\" v-if=\"!isLoading && events.length === 0\">\r\n      {{ $t('logs.empty_list') }}\r\n    </div>\r\n    <div class=\"has-text-centered\" v-if=\"isLoading\" >\r\n      <spinner />\r\n    </div>\r\n    <div class=\"log-list\" v-else>\r\n      <div\r\n        class=\"mt05 event-line\"\r\n        :key=\"event.id\"\r\n        @click=\"selectLine(event)\"\r\n        v-for=\"event in events\"\r\n      >\r\n        <div>\r\n          <span class=\"date tag mr1\">{{ formatDate(event.created_at) }} </span>\r\n          <span\r\n            class=\"type tag\"\r\n            :title=\"event.name.split(':')[1]\"\r\n            :data-status=\"formatType(event)\"\r\n          >\r\n            {{ formatType(event) }}\r\n          </span>\r\n          <span class=\"name tag mr1\">{{ event.name.split(':')[0] }}</span>\r\n        </div>\r\n        <ul v-show=\"selectedEvents[event.id]\">\r\n          <li class=\"flexrow\">\r\n            <span class=\"key\">user</span>\r\n            <people-avatar\r\n              class=\"flexrow-item\"\r\n              :size=\"20\"\r\n              :person=\"personMap[event.user_id]\"\r\n              v-if=\"event.user_id\"\r\n            />\r\n            <people-name\r\n              class=\"flexrow-item\"\r\n              :person=\"personMap[event.user_id]\"\r\n              v-if=\"event.user_id\"\r\n            />\r\n          </li>\r\n          <li\r\n            class=\"variable\"\r\n            :key=\"event.id + '-' + key\"\r\n            v-for=\"key in Object.keys(event.data).sort()\"\r\n          >\r\n            <span class=\"key\">{{ key }}</span>\r\n            <a :href=\"getLink(event, key)\" v-if=\"isLink(key)\">\r\n              {{ event.data[key] }}\r\n            </a>\r\n            <span v-else>{{ event.data[key] }}</span>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport moment from 'moment'\r\nimport Vue from 'vue'\r\n\r\nimport { formatSimpleDate } from '@/lib/time'\r\n\r\nimport ButtonSimple from '@/components/widgets/ButtonSimple'\r\nimport DateField from '@/components/widgets/DateField'\r\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar'\r\nimport PeopleName from '@/components/widgets/PeopleName'\r\nimport PageTitle from '@/components/widgets/PageTitle'\r\nimport Spinner from '@/components/widgets/Spinner'\r\n\r\nexport default {\r\n  name: 'logs',\r\n\r\n  components: {\r\n    ButtonSimple,\r\n    DateField,\r\n    PageTitle,\r\n    PeopleAvatar,\r\n    PeopleName,\r\n    Spinner\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      currentDate: new Date(),\r\n      events: [],\r\n      isLoading: true,\r\n      selectedEvents: {}\r\n    }\r\n  },\r\n\r\n  mounted () {\r\n    this.loadDayEvents()\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\r\n      'personMap',\r\n      'productionMap',\r\n      'user'\r\n    ]),\r\n\r\n    today () {\r\n      return moment().toDate()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      'loadEvents'\r\n    ]),\r\n\r\n    formatDate (eventDate) {\r\n      return moment\r\n        .tz(eventDate, 'UTC')\r\n        .tz(this.user.timezone)\r\n        .format('YYYY-MM-DD HH:mm:ss')\r\n    },\r\n\r\n    formatType (event) {\r\n      return event.name.split(':')[1].substring(0, 3)\r\n    },\r\n\r\n    loadDayEvents () {\r\n      const before = moment(this.currentDate).add(1, 'days')\r\n      const after = moment(this.currentDate)\r\n      this.selectedEvents = {}\r\n      this.isLoading = true\r\n      this.loadEvents({\r\n        after: formatSimpleDate(after),\r\n        before: formatSimpleDate(before)\r\n      })\r\n        .then((events) => {\r\n          this.isLoading = false\r\n          this.events = events\r\n        })\r\n        .catch((err) => {\r\n          this.isLoading = false\r\n          console.error(err)\r\n        })\r\n    },\r\n\r\n    selectLine (event) {\r\n      Vue.set(this.selectedEvents, event.id, !this.selectedEvents[event.id])\r\n    },\r\n\r\n    isLink (key) {\r\n      const linkKeys = ['project_id', 'task_id']\r\n      return linkKeys.includes(key)\r\n    },\r\n\r\n    getLink (event, key) {\r\n      const productionId = event.data.project_id\r\n      const entityType = key.substring(0, key.length - 3)\r\n      if (entityType === 'project') {\r\n        return `/productions/${productionId}/news-feed`\r\n      } else {\r\n        const entityId = event.data[key]\r\n        return `/productions/${productionId}/${entityType}s/${entityId}`\r\n      }\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    currentDate () {\r\n      this.loadDayEvents()\r\n    }\r\n  },\r\n\r\n  metaInfo () {\r\n    return {\r\n      title: `${this.$t('logs.title')} - Kitsu`\r\n    }\r\n  }\r\n\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.fixed-page {\r\n  margin-top: 60px;\r\n  padding: 2em;\r\n  overflow: scroll;\r\n}\r\n\r\n.log-list {\r\n  margin-bottom: 2em;\r\n}\r\n\r\n.event-line {\r\n  cursor: pointer;\r\n\r\n  .tag {\r\n    border-radius: 4px;\r\n  }\r\n\r\n  .date {\r\n    font-weight: 500;\r\n  }\r\n\r\n  .type {\r\n    text-transform: uppercase;\r\n    min-width: 50px;\r\n  }\r\n\r\n  .type[data-status=\"new\"] {\r\n    color: white;\r\n    background: $green;\r\n  }\r\n\r\n  .type[data-status=\"upd\"] {\r\n    color: white;\r\n    background: $blue;\r\n  }\r\n\r\n  .type[data-status=\"add\"] {\r\n    color: white;\r\n    background: $dark-purple;\r\n  }\r\n\r\n  .type[data-status=\"del\"] {\r\n    color: white;\r\n    background: $red;\r\n  }\r\n\r\n  .type[data-status=\"sta\"] {\r\n    color: white;\r\n    background: $pink;\r\n  }\r\n\r\n  .type[data-status=\"set\"] {\r\n    background: $light-purple;\r\n  }\r\n\r\n  ul {\r\n    border-left: 3px solid $light-grey;\r\n    list-style-type: none;\r\n    margin: 1em 1em 2em 0.2em;\r\n    padding-left: 1em;\r\n\r\n    .key {\r\n      font-weight: 500;\r\n      width: 170px;\r\n      display: inline-block;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Logs.vue?vue&type=template&id=2bab798e&scoped=true&\"\nimport script from \"./Logs.vue?vue&type=script&lang=js&\"\nexport * from \"./Logs.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Logs.vue?vue&type=style&index=0&id=2bab798e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2bab798e\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}