(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7a54222"],{"0024":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"data-list"},[s("div",{staticStyle:{overflow:"hidden"}},[s("table",{ref:"headerWrapper",staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",{staticClass:"datatable-row-header"},[s("th",{staticClass:"type"},[t._v(" "+t._s(t.$t("tasks.fields.task_type"))+" ")]),s("th",{staticClass:"status"},[t._v(" "+t._s(t.$t("tasks.fields.task_status"))+" ")]),s("th",{staticClass:"assignees"},[t._v(" "+t._s(t.$t("tasks.fields.assignees"))+" ")]),s("th",{staticClass:"end-cell"})])])])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.entries.length>0?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}]},[s("table",{staticClass:"datatable"},[s("tbody",{staticClass:"datatable-body"},t._l(t.sortedEntries,(function(e){return s("tr",{key:"string"===typeof e?e:e.id,class:{selected:t.currentTask&&t.currentTask.id===e,"datatable-row":!0,"datatable-row--selectable":!0},on:{click:function(s){t.selectTask(t.getTask(e))}}},[t.getTaskType(e)?s("task-type-cell",{staticClass:"type",attrs:{"task-type":t.getTaskType(e),"production-id":t.currentProduction.id}}):t._e(),s("td",{staticClass:"status"},[t.getTask(e)?s("validation-tag",{attrs:{task:t.getTask(e),"is-static":!0}}):t._e()],1),s("td",{staticClass:"assignees"},[t.isCurrentUserClient||t.isCurrentUserVendor?t._e():s("div",{staticClass:"flexrow"},t._l(t.getAssignees(e),(function(n){return s("div",{key:n,staticClass:"avatar-wrapper"},[s("people-avatar",{key:e+"-"+n,staticClass:"person-avatar flexrow-item",attrs:{person:t.personMap[n],size:30,"font-size":15}})],1)})),0)]),s("td",{staticClass:"end-cell"})],1)})),0)])]):t._e()],1)},i=[],a=s("2909"),r=s("5530"),o=(s("d3b7"),s("ddb0"),s("b0c0"),s("2f62")),c=s("58f5"),l=s("e60b"),d=s("fe13"),u=s("eb8c"),p={name:"entity-task-list",components:{TableInfo:l["a"],TaskTypeCell:c["a"],PeopleAvatar:u["a"],ValidationTag:d["a"]},props:{entries:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},data:function(){return{currentTask:null}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["currentProduction","isCurrentUserClient","isCurrentUserVendor","personMap","taskMap","taskTypeMap"])),{},{sortedEntries:function(){var t=this;return Object(a["a"])(this.entries).sort((function(e,s){var n=t.getTask(e),i=t.getTask(s),a=t.getTask(t.taskTypeMap[n.task_type_id]),r=t.getTask(t.taskTypeMap[i.task_type_id]);return a.priority===r.priority?t.taskTypeA.localeCompare(t.taskTypeB.name):a.priority-r.priority}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])([])),{},{onBodyScroll:function(t,e){this.$refs.headerWrapper.style.left="-".concat(e.scrollLeft,"px")},getTask:function(t){return"string"===typeof t?this.taskMap[t]:t},getTaskType:function(t){var e=this.getTask(t);return e?this.taskTypeMap[e.task_type_id]:null},getAssignees:function(t){var e=this.getTask(t);return e?e.assignees:[]},selectTask:function(t){this.currentTask=t,this.$emit("task-selected",t)}})},f=p,h=(s("fbf0"),s("2877")),_=Object(h["a"])(f,n,i,!1,null,"643efec3",null);e["a"]=_.exports},"0dd7":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"columns fixed-page asset"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"page-header flexrow"},[s("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:t.assetsPath}},[s("chevron-left-icon")],1),t.currentAsset?s("entity-thumbnail",{staticClass:"asset-thumbnail flexrow-item",attrs:{entity:t.currentAsset,"with-link":!1}}):t._e(),s("div",{staticClass:"flexrow-item"},[s("page-title",{staticClass:"entity-title",attrs:{text:t.title}})],1),s("div",{staticClass:"flexrow-item"},[t.isCurrentUserManager?s("button-simple",{attrs:{icon:"edit"},on:{click:function(e){t.modals.edit=!0}}}):t._e()],1)],1),s("div",{staticClass:"flexrow infos"},[s("div",{staticClass:"flexrow-item"},[s("page-subtitle",{attrs:{text:t.$t("assets.tasks")}}),s("entity-task-list",{staticClass:"task-list",attrs:{entries:t.currentAsset?t.currentAsset.tasks:[],"is-loading":!t.currentAsset,"is-error":!1},on:{"task-selected":t.onTaskSelected}})],1),s("div",{staticClass:"flexrow-item"},[s("page-subtitle",{attrs:{text:t.$t("main.info")}}),s("div",{staticClass:"table-body"},[t.currentAsset?s("table",{staticClass:"datatable"},[s("tbody",{staticClass:"table-body"},[s("tr",{staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(t._s(t.$t("assets.fields.description")))]),s("description-cell",{attrs:{entry:t.currentAsset,full:!0}})],1),t._l(t.assetMetadataDescriptors,(function(e){return s("tr",{key:e.id,staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(t._s(e.name))]),s("td",[t._v(" "+t._s(t.currentAsset.data?t.currentAsset.data[e.field_name]:"")+" ")])])})),s("tr",{staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v("Metadata")]),s("td",[s("Collapsible",{attrs:{isOpen:!1}},[s("v-jsoneditor",{staticClass:"json-editor",attrs:{options:t.options,plus:!0,height:"400px"},model:{value:t.metadata,callback:function(e){t.metadata=e},expression:"metadata"}})],1)],1)])],2)]):t._e()])],1)]),s("div",{staticClass:"asset-casted-in"},[s("page-subtitle",{attrs:{text:t.$t("assets.cast_in")}}),t.currentAsset?s("div",[t.currentAsset.castInShotsBySequence&&t.currentAsset.castInShotsBySequence[0].length>0?s("div",t._l(t.currentAsset.castInShotsBySequence,(function(e){return e[0].sequence_name?s("div",{key:e.length>0?e[0].sequence_name:"",staticClass:"sequence-shots"},[s("div",{staticClass:"shot-sequence"},[t._v(" "+t._s(e.length>0?e[0].sequence_name:"")+" ")]),s("div",{staticClass:"shot-list"},t._l(e,(function(e){return s("router-link",{key:e.shot_id,staticClass:"shot-link",attrs:{to:t.shotPath(e)}},[s("entity-thumbnail",{attrs:{entity:e,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",[t._v(t._s(e.shot_name))]),e.nb_occurences>1?s("span",[t._v(" ("+t._s(e.nb_occurences)+") ")]):t._e()])],1)})),1)]):t._e()})),0):s("div",[t._v(" "+t._s(t.$t("assets.no_cast_in"))+" ")])]):s("table-info",{attrs:{"is-loading":t.castIn.isLoadin,"is-error":t.castIn.isError}}),t.currentAsset&&t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",[s("page-subtitle",{attrs:{text:"Linked"}}),t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",t._l(t.currentAsset.castingAssetsByType,(function(e){return s("div",{key:e.length>0?e[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[t._v(" "+t._s(e.length>0?e[0].asset_type_name:"")+" ("+t._s(e.length)+") ")]),s("div",{staticClass:"asset-list"},t._l(e,(function(e){return s("router-link",{key:e.id,staticClass:"asset-link",attrs:{to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:e.asset_id}}}},[s("entity-thumbnail",{attrs:{entity:e,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",[t._v(t._s(e.asset_name))]),e.nb_occurences>1?s("span",[t._v(" ("+t._s(e.nb_occurences)+") ")]):t._e()])],1)})),1)])})),0):t._e()],1):t._e()],1)]),t.currentTask?s("div",{staticClass:"column side-column"},[s("task-info",{attrs:{task:t.currentTask}})],1):t._e(),s("edit-asset-modal",{ref:"edit-asset-modal",attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"asset-to-edit":t.currentAsset},on:{cancel:function(e){t.modals.edit=!1},confirm:t.confirmEditAsset}})],1)},i=[],a=s("5530"),r=(s("b0c0"),s("4776"),s("bcb2")),o=s.n(r),c=s("371e"),l=s.n(c),d=s("2f62"),u=s("0a35"),p=s("de40"),f=s("0fcb"),h=s("813f"),_=s("0024"),g=s("bb21"),b=s("8d07"),m=s("8751"),y=s("e60b"),v=s("9d94"),C={name:"asset",components:{Collapsible:l.a,VJsoneditor:o.a,ButtonSimple:p["a"],ChevronLeftIcon:u["j"],DescriptionCell:f["a"],EditAssetModal:h["a"],EntityThumbnail:g["a"],EntityTaskList:_["a"],PageSubtitle:m["a"],PageTitle:b["a"],TableInfo:y["a"],TaskInfo:v["a"]},data:function(){return{currentAsset:null,currentTask:null,castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1},metadata:{},options:{name:"metadata root",mode:"form",modes:["tree","preview","form","code"]}}},mounted:function(){var t=this;this.clearSelectedTasks(),this.currentAsset=this.getCurrentAsset(),this.castIn.isLoading=!0,this.castIn.isError=!1,Object.assign(this.options,{onChangeText:this.onChangeMetadata}),this.currentAsset?(this.currentAsset.data&&this.currentAsset.data.metadata&&(this.metadata=this.currentAsset.data.metadata),this.loadAssetCastIn(this.currentAsset).then((function(){return t.loadAssetCasting(t.currentAsset)})).then((function(){t.castIn.isLoading=!1})).catch((function(e){t.castIn.isError=!0,console.error(e)}))):this.resetData()},computed:Object(a["a"])(Object(a["a"])({},Object(d["c"])(["assetMap","assetMetadataDescriptors","assetsPath","currentEpisode","currentProduction","isTVShow","isCurrentUserManager","route","shotId"])),{},{title:function(){return this.currentAsset?"".concat(this.currentAsset.asset_type_name," / ")+"".concat(this.currentAsset.name):"Loading..."},assetThumbnailPath:function(){var t=this.currentAsset.preview_file_id;return"/api/pictures/originals/preview-files/".concat(t,".png")},isPreview:function(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0}}),methods:Object(a["a"])(Object(a["a"])({},Object(d["b"])(["clearSelectedTasks","editAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadShots","setCurrentEpisode"])),{},{onChangeMetadata:function(t){if(console.log(t),this.currentAsset.data){var e=Object(a["a"])({},this.currentAsset.data);e.metadata=JSON.parse(t);var s={id:this.currentAsset.id,source_id:this.currentAsset.episode_id,episode_id:this.currentAsset.episode_id,data:e};this.editAsset(s)}},changeTab:function(t){this.selectedTab=t},getCurrentAsset:function(){return this.assetMap[this.route.params.asset_id]||null},onEditClicked:function(){this.modals.edit=!0},confirmEditAsset:function(t){var e=this;t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then((function(){e.loading.edit=!1,e.modals.edit=!1})).catch((function(t){console.error(t),e.loading.edit=!1,e.errors.edit=!0}))},onTaskSelected:function(t){this.currentTask=t},resetData:function(){var t=this;this.castIn.isLoading=!0,"main"===this.$route.params.episode_id&&this.setCurrentEpisode("main"),this.$nextTick((function(){t.loadAssets().then((function(){return t.currentAsset=t.getCurrentAsset(),t.loadAssetCastIn(t.currentAsset)})).then((function(){return t.loadAssetCasting(t.currentAsset)})).then((function(){t.castIn.isLoading=!1})).catch((function(e){t.castIn.isError=!0,t.castIn.isLoading=!1,console.error(e)}))}))},shotPath:function(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}}}),watch:{currentProduction:function(){this.isTVShow||this.resetData()},currentEpisode:function(){this.isTVShow&&"main"!==this.currentEpisode.id&&this.resetData()}},metaInfo:function(){return{title:"".concat(this.title," - Kitsu")}}},k=C,T=(s("ef7c"),s("c33a"),s("2877")),A=Object(T["a"])(k,n,i,!1,null,"4bc5f6b8",null);e["default"]=A.exports},"371e":function(t,e,s){t.exports=function(t){var e={};function s(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fb15")}({"6ccd":function(t,e,s){},"80d7":function(t,e,s){"use strict";var n=s("6ccd"),i=s.n(n);i.a},8875:function(t,e,s){var n,i,a;(function(s,r){i=[],n=r,a="function"===typeof n?n.apply(e,i):n,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){if(document.currentScript)return document.currentScript;try{throw new Error}catch(u){var t,e,s,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,i=/@([^@]*):(\d+):(\d+)\s*$/gi,a=n.exec(u.stack)||i.exec(u.stack),r=a&&a[1]||!1,o=a&&a[2]||!1,c=document.location.href.replace(document.location.hash,""),l=document.getElementsByTagName("script");r===c&&(t=document.documentElement.outerHTML,e=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=t.replace(e,"$1").trim());for(var d=0;d<l.length;d++){if("interactive"===l[d].readyState)return l[d];if(l[d].src===r)return l[d];if(r===c&&l[d].innerHTML&&l[d].innerHTML.trim()===s)return l[d]}return null}}return t}))},fb15:function(t,e,s){"use strict";if(s.r(e),"undefined"!==typeof window){var n=window.document.currentScript,i=s("8875");n=i(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:i});var a=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"Collapsible"},[s("button",{class:{Collapsible__trigger:!0,"Collapsible__trigger--open":!t.transitioning&&t.open,"Collapsible__trigger--closed":!t.transitioning&&!t.open,"Collapsible__trigger--transitioning":t.transitioning},on:{click:t.handleClick}},[t.open?t._t("trigger",[s("span",{staticClass:"Collapsible__triggerLabel"},[t._v(" "+t._s(t.open?t.openLabel:t.closedLabel)+" ")])]):t._e(),t.open?t._e():t._t("closedTrigger",[t._t("trigger",[s("span",{staticClass:"Collapsible__triggerLabel"},[t._v(t._s(t.open?t.openLabel:t.closedLabel))])])])],2),s("div",{class:{Collapsible__content:!0,"Collapsible__content--open":!t.transitioning&&t.open,"Collapsible__content--closed":!t.transitioning&&!t.open,"Collapsible__content--transitioning":t.transitioning},style:{height:t.height,transitionProperty:"height",transitionDuration:t.transitionDuration,transitionTimingFunction:t.transitionTimingFunction,transitionDelay:t.transitionDelay},on:{transitionend:t.handleEnd}},[s("div",{ref:"inner",staticClass:"Collapsible__contentInner"},[t._t("default")],2)])])},o=[],c={name:"Collapsible",data:function(){return{open:this.isOpen,height:this.isOpen?"auto":"0px",closeOnNextTick:!1,transitioning:!1}},props:{openLabel:{type:String,default:"Close me"},closedLabel:{type:String,default:"Open me"},transitionDuration:{type:String,default:"400ms"},transitionTimingFunction:{type:String,default:"ease"},transitionDelay:{type:String,default:"0s"},isOpen:{default:!0,type:Boolean},onCollapse:{default:function(){},type:Function}},methods:{handleClick:function(){this.onCollapse(!this.isOpen),this.open=!this.open},handleEnd:function(){"0px"!==this.height&&(this.height="auto"),this.transitioning=!1}},watch:{open:function(t,e){this.transitioning=!0,this.height=this.$refs.inner.scrollHeight+"px",!0===e&&(this.closeOnNextTick=!0)},isOpen:function(t){this.open=t}},updated:function(){var t=this;this.$nextTick((function(){window.setTimeout((function(){t.closeOnNextTick&&(t.height="0px",t.closeOnNextTick=!1)}))}))}},l=c;s("80d7");function d(t,e,s,n,i,a,r,o){var c,l="function"===typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=s,l._compiled=!0),n&&(l.functional=!0),a&&(l._scopeId="data-v-"+a),r?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=c):i&&(c=o?function(){i.call(this,this.$root.$options.shadowRoot)}:i),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:t,options:l}}var u=d(l,r,o,!1,null,"545f03a3",null),p=u.exports;e["default"]=p}})["default"]},"46dd":function(t,e,s){},4776:function(t,e,s){},"5f54":function(t,e,s){},c33a:function(t,e,s){"use strict";s("ce68")},ce68:function(t,e,s){},ef7c:function(t,e,s){"use strict";s("5f54")},fbf0:function(t,e,s){"use strict";s("46dd")}}]);
//# sourceMappingURL=chunk-a7a54222.7d6a5831.js.map